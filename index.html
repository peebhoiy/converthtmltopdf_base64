<!--
 Copyright 2024 Pius Odiahi
 
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
 
     https://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to PDF Form</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Include CKEditor -->
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">HTML to PDF Form</h1>
        <form id="pdfForm" action="process_form.php" method="post">
            <div class="mb-3">
                <!-- Text editor textarea -->
                <label for="editor" class="form-label">Enter HTML Content:</label>
                <textarea name="html_content" id="editor" class="form-control" rows="6"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Convert to PDF and Save</button>
        </form>
    </div>

    <!-- Bootstrap JS (Optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize CKEditor
        CKEDITOR.replace('editor');

        // Add event listener for form submission
        document.getElementById('pdfForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            // Submit the form via AJAX
            var formData = new FormData(this);

            fetch(this.action, {
                method: this.method,
                body: formData
            })
            .then(response => response.json()) // Parse response as JSON
            .then(data => {
                if (data.success) {
                    // Show success modal
                    showSuccessModal(data.message);
                } else {
                    // Show error modal
                    showErrorModal(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Show error modal
                showErrorModal('An error occurred. Please try again later.');
            });
        });

        // Function to show success modal
        function showSuccessModal(message) {
            var successModal = new bootstrap.Modal(document.getElementById('successModal'));
            document.getElementById('successMessage').innerText = message;
            successModal.show();
        }

        // Function to show error modal
        function showErrorModal(message) {
            var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
            document.getElementById('errorMessage').innerText = message;
            errorModal.show();
        }
    </script>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">Success!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="successMessage"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Error!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="errorMessage"></p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>